!function(e,t,o){"use strict";var a=t.module("nsPopover",[]),i=t.element,r=t.isDefined,n=(t.forEach,[]),c=0;a.directive("nsPopover",function(a,l,u,s,m,d){return{restrict:"A",link:function(p,v,h){function f(e,t,o,a,i){var r,n,c=g(e[0]),l=function(){return"center"===o?Math.round(a.left+a.width/2-c.width/2):"right"===o?a.right-c.width:a.left},u=function(){return"center"===o?Math.round(a.top+a.height/2-c.height/2):"bottom"===o?a.bottom-c.height:a.top};"top"===t?(r=a.top-c.height,n=l()):"right"===t?(r=u(),n=a.right):"bottom"===t?(r=a.bottom,n=l()):"left"===t&&(r=u(),n=a.left-c.width),e.css("top",r.toString()+"px").css("left",n.toString()+"px"),i&&("top"===t||"bottom"===t?(n=a.left+a.width/2-n,i.css("left",n.toString()+"px")):(r=a.top+a.height/2-r,i.css("top",r.toString()+"px")))}function g(t){var o=e,a=document.documentElement||document.body.parentNode||document.body,i=r(o.pageXOffset)?o.pageXOffset:a.scrollLeft,n=r(o.pageYOffset)?o.pageYOffset:a.scrollTop,c=t.getBoundingClientRect();return i||n?{bottom:c.bottom+n,left:c.left+i,right:c.right+i,top:c.top+n,height:c.height,width:c.width}:c}function b(e,o){return e?t.isString(e)&&o?e:l.get(e)||s.get(e,{cache:!0}):""}var w={template:h.nsPopoverTemplate,theme:h.nsPopoverTheme||"ns-popover-list-theme",plain:h.nsPopoverPlain,trigger:h.nsPopoverTrigger||"click",container:h.nsPopoverContainer,placement:h.nsPopoverPlacement||"bottom|left",timeout:h.nsPopoverTimeout||1.5},y={id_:o,hide:function(e,t){a.cancel(y.id_),r(t)||(t=1.5),y.id_=a(function(){e.css("display","none")},1e3*t)},cancel:function(){a.cancel(y.id_)}},D=i(w.container);D.length||(D=d.find("body"));var k,S,T;c+=1;var x=i('<div id="nspopover-'+c+'"></div>');n.push(x);var P=w.placement.match(/^(top|bottom|left|right)$|((top|bottom)\|(center|left|right)+)|((left|right)\|(center|top|bottom)+)/);if(!P)throw new Error('"'+w.placement+'" is not a valid placement or has a invalid combination of placements.');S=P[6]||P[3]||P[1],T=P[7]||P[4]||P[2]||"center",u.when(b(w.template,w.plain)).then(function(e){if(e=t.isString(e)?e:e.data&&t.isString(e.data)?e.data:"",x.html(e),w.theme&&x.addClass(w.theme),x.addClass("ns-popover-"+S+"-placement").addClass("ns-popover-"+T+"-align"),a(function(){m(x)(p)}),p.$on("$destroy",function(){x.remove()}),x.css("position","absolute").css("display","none"),k=x.find(".triangle"),!k.length)for(var o=x.children(),r=0;r<o.length;++r){var n=i(o[r]);if(n.hasClass("triangle")){k=n;break}}D.append(x)}),v.on(w.trigger,function(e){e.preventDefault(),y.cancel(),x.css("display","block"),f(x,S,T,g(v[0]),k),x.on("click",function(){y.hide(x,0)})}),v.on("mouseout",function(){y.hide(x,w.timeout)}).on("mouseover",function(){y.cancel()}),x.on("mouseout",function(){y.hide(x,w.timeout)}).on("mouseover",function(){y.cancel()})}}})}(window,window.angular),angular.module("cmm",["ui.router","nsPopover","cmm.services","cmm.pulse","cmm.tape"]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,o){e.state("api",{url:"/api",templateUrl:"./api.html"}).state("disclaimer",{url:"/disclaimer",templateUrl:"./disclaimer.html"}),t.otherwise("/pulse"),o.html5Mode(!0)}]).directive("cmmSplash",[function(){return{restrict:"E",template:'<canvas id="node-map"></canvas>',link:function(){function e(){s=window.innerWidth,m=400,h={x:s/2.5,y:m/2},d=document.getElementById("node-map"),d.width=s,d.height=m,p=d.getContext("2d"),v=[];for(var e=0;s>e;e+=s/10)for(var t=0;m>t;t+=m/10){var o=e+Math.random()*s/10,a=t+Math.random()*m/10,i={x:o,originX:o,y:a,originY:a};v.push(i)}for(var r=0;r<v.length;r++){for(var n=[],c=v[r],f=0;f<v.length;f++){var g=v[f];if(c!==g){for(var b=!1,w=0;5>w;w++)b||void 0===n[w]&&(n[w]=g,b=!0);for(var w=0;5>w;w++)b||u(c,g)<u(c,n[w])&&(n[w]=g,b=!0)}}c.closest=n}for(var r in v){var y=new l(v[r],2+2*Math.random(),"rgba(255,255,255,.5)");v[r].circle=y}}function t(){window.addEventListener("scroll",o),window.addEventListener("resize",a)}function o(){f=document.body.scrollTop>m?!1:!0}function a(){s=window.innerWidth,m=window.innerHeight,d.width=s,d.height=m}function i(){r();for(var e in v)n(v[e])}function r(){if(f){p.clearRect(0,0,s,m);for(var e in v)Math.abs(u(h,v[e]))<7e3?(v[e].active=.3,v[e].circle.active=.6):Math.abs(u(h,v[e]))<2e5?(v[e].active=.1,v[e].circle.active=.3):Math.abs(u(h,v[e]))<4e5?(v[e].active=.02,v[e].circle.active=.1):(v[e].active=0,v[e].circle.active=0),c(v[e]),v[e].circle.draw()}requestAnimationFrame(r)}function n(e){TweenLite.to(e,1+1*Math.random(),{x:e.originX-50+100*Math.random(),y:e.originY-50+100*Math.random(),ease:Circ.easeInOut,onComplete:function(){n(e)}})}function c(e){if(e.active)for(var t in e.closest)p.beginPath(),p.moveTo(e.x,e.y),p.lineTo(e.closest[t].x,e.closest[t].y),p.strokeStyle="rgba(240,152,25,"+e.active+")",p.stroke()}function l(e,t,o){var a=this;!function(){a.pos=e||null,a.radius=t||null,a.color=o||null}(),this.draw=function(){a.active&&(p.beginPath(),p.arc(a.pos.x,a.pos.y,a.radius,0,2*Math.PI,!1),p.fillStyle="rgba(240,152,25,"+a.active+")",p.fill())}}function u(e,t){return Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)}var s,m,d,p,v,h,f=!0;e(),i(),t()}}}]),angular.module("cmm.pulse",["cmm.services","ui.router"]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("pulse",{url:"/pulse",templateUrl:"./app/pulse/pulse.html",controller:"PulseCtrl"}),t.otherwise("/pulse")}]),angular.module("cmm.pulse").controller("PulseCtrl",["$scope","MarketData",function(e,t){e.chartData={},e.summary=t.summary,e.chartData.cov=t.cov,e.chartData.range=t.range,e.chartData.volume=t.volume,e.chartData.price=t.price,e.chartData.btcVolume=t.price,e.chartData.priceDist=t.priceDist}]),angular.module("cmm.services",["cmm.sockets"]).factory("MarketData",["PriceData","PriceDistData","COVData","VolumeData","RangeData","SummaryData","TradeData",function(e,t,o,a,i,r,n){return{price:e,priceDist:t,cov:o,volume:a,range:i,summary:r,trades:n}}]),angular.module("cmm.sockets",["btford.socket-io"]).factory("Sockets",["socketFactory",function(e){var t={cov:io.connect("http://api.marketmonitor.io:80/BTC/USD/coefficientOfVariation"),range:io.connect("http://api.marketmonitor.io:80/BTC/USD/range"),volume:io.connect("http://api.marketmonitor.io:80/BTC/USD/volume"),trades:io.connect("http://api.marketmonitor.io:80/BTC/USD/trades"),summary:io.connect("http://api.marketmonitor.io:80/BTC/USD/summary"),priceDist:io.connect("http://api.marketmonitor.io:80/BTC/USD/priceDistribution"),priceData:io.connect("http://api.marketmonitor.io:80/BTC/USD/priceCharts/fifteenMinutes"),rangeDetails:io.connect("http://api.marketmonitor.io:80/BTC/USD/range"),volumeDetails:io.connect("http://api.marketmonitor.io:80/BTC/USD/volume")},o={cov:e({ioSocket:t.cov}),range:e({ioSocket:t.range}),volume:e({ioSocket:t.volume}),trades:e({ioSocket:t.trades}),summary:e({ioSocket:t.summary}),priceDist:e({ioSocket:t.priceDist}),priceData:e({ioSocket:t.priceData}),rangeDetails:e({ioSocket:t.rangeDetails}),volumeDetails:e({ioSocket:t.volumeDetails})};return o}]),angular.module("cmm.tape",["ui.router","cmm.services"]).config(function(e,t){e.state("tape",{url:"/tape",templateUrl:"./app/tape/tape.html",controller:"TapeCtrl"}),t.otherwise("/pulse")}).controller("TapeCtrl",["$scope","MarketData",function(e,t){e.tape=t.trades.tape}]),angular.module("cmm.pulse").directive("btcVolumeChart",["$filter",function(e){var t={chartArea:{width:"100%",height:"100%"},axisTitlesPosition:"in",legend:"none",hAxis:{textPosition:"in"},vAxis:{title:"BTC Volume",textPosition:"in"},tooltip:{isHtml:!0},crosshair:{trigger:"selection"}};return{restrict:"E",template:'<div class="col-chart"></div>',replace:!0,scope:{data:"="},link:function(o,a){var i,r,n=function(t){var o={};return o.price={},o.volume={},o.price.cols=[{id:"date",label:"Date",type:"datetime"},{id:"vwap",label:"VWAP",type:"number"},{id:"high",type:"number",role:"interval"},{id:"low",type:"number",role:"interval"},{id:"tooltip",type:"string",role:"tooltip",p:{html:!0}}],o.price.rows=[],o.volume.cols=[{id:"date",label:"Date",type:"datetime"},{id:"volume",label:"Volume",type:"number"},{id:"tooltip",type:"string",role:"tooltip",p:{html:!0}}],o.volume.rows=[],t.forEach(function(t){t.date=new Date(t.date),o.price.rows.push({c:[{v:t.date},{v:t.vwap},{v:t.high},{v:t.low},{v:'<div class="chart-tooltip"><b>'+e("date")(t.date)+"</b><br>VWAP: <b>"+e("currency")(t.vwap)+"</b><br>  High: <b>"+e("currency")(t.high)+"</b><br> Low: <b>"+e("currency")(t.low)+"</b><br> Volume: <b>"+e("number")(t.volume,2)+"</b><br></div>"}]}),o.volume.rows.push({c:[{v:t.date},{v:t.volume},{v:'<div class="chart-tooltip"><b>'+e("date")(t.date)+"</b><br>  High: <b>"+e("currency")(t.high)+"</b><br> Low: <b>"+e("currency")(t.low)+"</b><br> Volume: <b>"+e("number")(t.volume,2)+"</b><br></div>"}]})}),o},c=function(){var e=new google.visualization.DataTable(i.volume);r.draw(e,t)};o.$watch("data",function(e){e=e[0],e&&e.length&&(i=n(e),r=new google.visualization.AreaChart(a[0]),i&&c())},!0)}}}]),angular.module("cmm.services").factory("COVData",["Sockets",function(e){var t=e.cov,o={};return t.on("update",function(e){o.percentile=e.percentile}),o}]),angular.module("cmm.services").factory("PriceData",["Sockets",function(e){var t=e.priceData,o=[];return t.on("update",function(e){o.splice(0,1,e)}),o}]),angular.module("cmm.services").factory("PriceDistData",["Sockets",function(e){var t=e.priceDist,o=[];return t.on("update",function(e){o.splice(0,1,e)}),o}]),angular.module("cmm.services").factory("RangeData",["Sockets",function(e){var t=e.range,o={};return t.on("update",function(e){o.percentile=e.percentile}),o}]),angular.module("cmm.services").factory("SummaryData",["Sockets",function(e){var t=e.summary,o={};return t.on("update",function(e){o.lastUpdate=(new Date).toISOString(),o.high=e.high.toFixed(2),o.low=e.low.toFixed(2),o.range=100*e.range,o.vwap=e.vwap.toFixed(2),o.volumeBTC=Math.round(e.volume),o.volumeUSD=Math.round(e.volume*e.vwap),o.volatility=100*e.coefficientOfVariation,o.numTrades=Math.round(e.numTrades),o.avgTrade=e.volume/e.numTrades}),o}]),angular.module("cmm.services").factory("TradeData",["Sockets",function(e){var t=[],o=e.trades,a=function(e){var t={},o=new Date(e.date),a=o.getMinutes(),i=o.getSeconds();return t.hours=""+o.getHours(),t.minutes=10>a?"0"+a:""+a,t.seconds=10>i?"0"+i:""+i,t.price=e.price,t.amount=e.amount,t.usd="$"+e.price*e.amount,t.exchange=e.exchange,t};return o.on("trade",function(e){t.unshift(a(e)),t.length>20&&t.pop()}),{tape:t}}]),angular.module("cmm.services").factory("VolumeData",["Sockets",function(e){var t=e.volume,o={};return t.on("update",function(e){o.percentile=e.percentile}),o}]),angular.module("cmm.pulse").directive("covChart",[function(){var e={width:"220",height:"220",redFrom:90,redTo:100,yellowFrom:75,yellowTo:90};return{restrict:"E",template:'<div class="col"></div>',replace:!0,scope:{data:"="},link:function(t,o){var a=function(t,a){google.visualization.events.addListener(t,"ready",function(){var e=angular.element(o.find("circle")[0]),t=o.find("text");e.attr("fill","#ddd"),e.attr("stroke","#ddd"),angular.forEach(t,function(e){angular.element(e).attr("font-family","Source Sans Pro")})}),a=google.visualization.arrayToDataTable(a),t.draw(a,e)};t.$watch("data",function(e){if(e.percentile){var t=new google.visualization.Gauge(o[0]),i=Math.round(100*e.percentile),r=[["Label","Value"],["Volatility",i]];a(t,r)}},!0)}}}]),angular.module("cmm.pulse").directive("rangeChart",[function(){var e={width:"220",height:"220",redFrom:90,redTo:100,yellowFrom:75,yellowTo:90};return{restrict:"E",template:'<div class="col"></div>',replace:!0,scope:{data:"="},link:function(t,o){var a=function(t,a){google.visualization.events.addListener(t,"ready",function(){var e=angular.element(o.find("circle")[0]),t=o.find("text");e.attr("fill","#ddd"),e.attr("stroke","#ddd"),angular.forEach(t,function(e){angular.element(e).attr("font-family","Source Sans Pro")})}),a=google.visualization.arrayToDataTable(a),t.draw(a,e)};t.$watch("data",function(e){if(e.percentile){var t=new google.visualization.Gauge(o[0]),i=Math.round(100*e.percentile),r=[["Label","Value"],["Range",i]];a(t,r)}},!0)}}}]),angular.module("cmm.pulse").directive("volumeChart",[function(){var e={width:"220",height:"220",redFrom:90,redTo:100,yellowFrom:75,yellowTo:90};return{restrict:"E",template:'<div class="col"></div>',replace:!0,scope:{data:"="},link:function(t,o){var a=function(t,a){google.visualization.events.addListener(t,"ready",function(){var e=angular.element(o.find("circle")[0]),t=o.find("text");e.attr("fill","#ddd"),e.attr("stroke","#ddd"),angular.forEach(t,function(e){angular.element(e).attr("font-family","Source Sans Pro")})}),a=google.visualization.arrayToDataTable(a),t.draw(a,e)};t.$watch("data",function(e){if(e.percentile){var t=new google.visualization.Gauge(o[0]),i=Math.round(100*e.percentile),r=[["Label","Value"],["Volume",i]];a(t,r)}},!0)}}}]),angular.module("cmm.pulse").directive("priceChart",["$filter",function(e){var t={chartArea:{width:"100%",height:"100%"},axisTitlesPosition:"in",legend:"none",vAxis:{title:"USD Price per BTC",textPosition:"in"},hAxis:{textPosition:"in"},curveType:"function",intervals:{style:"area"},tooltip:{isHtml:!0},crosshair:{trigger:"selection"}};return{restrict:"E",template:'<div class="col-chart"></div>',replace:!0,scope:{data:"="},link:function(o,a){var i,r,n=function(t){var o={};return o.price={},o.volume={},o.price.cols=[{id:"date",label:"Date",type:"datetime"},{id:"vwap",label:"VWAP",type:"number"},{id:"high",type:"number",role:"interval"},{id:"low",type:"number",role:"interval"},{id:"tooltip",type:"string",role:"tooltip",p:{html:!0}}],o.price.rows=[],o.volume.cols=[{id:"date",label:"Date",type:"datetime"},{id:"volume",label:"Volume",type:"number"},{id:"tooltip",type:"string",role:"tooltip",p:{html:!0}}],o.volume.rows=[],t.forEach(function(t){t.date=new Date(t.date),o.price.rows.push({c:[{v:t.date},{v:t.vwap},{v:t.high},{v:t.low},{v:'<div class="chart-tooltip"><b>'+e("date")(t.date)+"</b><br>VWAP: <b>"+e("currency")(t.vwap)+"</b><br>  High: <b>"+e("currency")(t.high)+"</b><br> Low: <b>"+e("currency")(t.low)+"</b><br> Volume: <b>"+e("number")(t.volume,2)+"</b><br></div>"}]}),o.volume.rows.push({c:[{v:t.date},{v:t.volume},{v:'<div class="chart-tooltip"><b>'+e("date")(t.date)+"</b><br>  High: <b>"+e("currency")(t.high)+"</b><br> Low: <b>"+e("currency")(t.low)+"</b><br> Volume: <b>"+e("number")(t.volume,2)+"</b><br></div>"}]})}),o},c=function(){var e=new google.visualization.DataTable(i.price);r.draw(e,t)};o.$watch("data",function(e){e=e[0],e&&e.length&&(i=n(e),r=new google.visualization.LineChart(a[0]),i&&c())},!0)}}}]),angular.module("cmm.pulse").directive("priceDistChart",["Sockets",function(){var e={hAxis:{title:"Price"},vAxis:{title:"Quantity"},theme:"maximized",isStacked:!0},t=function(e){var t=["Exchanges"],o=[],a=[];return e.forEach(function(e){_.contains(t,e.exchange)||t.push(e.exchange),_.contains(o,e.price)||o.push(e.price)}),t.push({role:"annotation"}),a.push(t),o.forEach(function(e){for(var o=[e],i=1;i<t.length-1;i++)o.push(0);o.push(""),a.push(o)}),e.forEach(function(e){var i=t.indexOf(e.exchange),r=o.indexOf(e.price)+1;a[r][i]=Number(e.volume.toFixed(2))}),a};return{restrict:"E",template:'<div class="col-chart"></div>',replace:!0,scope:{data:"="},link:function(o,a){var i,r,n=function(){var t=google.visualization.arrayToDataTable(i);r.draw(t,e)};o.$watch("data",function(e){e=e[0],e&&e.length&&(i=t(e),r=new google.visualization.ColumnChart(a[0]),i&&n())},!0)}}}]);